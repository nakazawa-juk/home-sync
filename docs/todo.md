# HomeSync - 統合 TODO

## 開発フロー

```
Web実装(完了) → DB構築・繋ぎ込み(完了) → PDF機能実装(着手中) → Web-PDF連携 → 調整・改善 → リリース
```

---

## 🎯 現在の進捗状況

- **開始日**: 2025/08/10
- **現在のフェーズ**: PDF 機能実装（Phase 3）
- **完了タスク数**: Phase 1・2 完了（Web UI + FastAPI 基盤）
- **現在着手中**: Supabase 連携（Python 側）→PDF 生成 →PDF 解析の順で実装

---

## ✅ Phase 1: Web UI 実装【完了】

### 完了済みタスク

- [x] プロジェクト一覧画面
  - [x] サイドバーナビゲーション
  - [x] プロジェクト一覧テーブル
  - [x] フィルター機能（UI のみ）
  - [x] 新規作成・PDF インポートボタン
  - [x] 空の状態表示
- [x] プロジェクト詳細画面
  - [x] 概要タブ実装
  - [x] 工程表タブ実装
  - [x] ガントチャート表示
  - [x] タブ切り替え機能
- [x] レスポンシブ対応
  - [x] デスクトップ表示
  - [x] タブレット対応
  - [x] モバイル対応
- [x] 状態管理
  - [x] ローディング状態
  - [x] エラー状態
  - [x] 空データ状態

---

## ✅ DB 構築・Web 連携【完了】

### 完了済みタスク

- [x] Supabase セットアップ
  - [x] プロジェクト作成
  - [x] データベーススキーマ作成
  - [x] テーブル作成（projects, project_schedules, schedule_items）
- [x] Next.js 側実装
  - [x] Supabase クライアント設定
  - [x] Server Actions 実装
  - [x] データ取得・更新ロジック
  - [x] DB データと画面の繋ぎ込み（全画面完了）

---

## 🔄 Phase 2: PDF 処理サービス基盤【着手中】

### サンプル PDF 作成【完了】

- [x] 標準フォーマット設計
- [x] サンプル PDF 生成スクリプト作成（/docs/samples/）
- [x] sample_schedule.pdf 生成完了
- [x] DB スキーマとの整合性確認

### FastAPI 基盤構築【完了】

- [x] `backend/` ディレクトリ作成
- [x] FastAPI プロジェクト初期化
- [x] `requirements.txt` 作成（FastAPI, PyMuPDF, Supabase 等）
- [x] `main.py` 基本アプリケーション作成
- [x] `config.py` 設定管理実装
- [x] `database.py` Supabase 接続設定
- [x] `pyproject.toml` プロジェクト設定作成
- [x] `.env.example` 環境変数テンプレート作成
- [x] `/health` エンドポイント実装
- [x] CORS 設定（Next.js 連携用）
- [x] エラーハンドリング基盤
- [x] ログ設定
- [x] Dockerfile 作成

---

## ⏳ Phase 3: PDF 処理機能実装【着手】

### ✅ 1. Supabase 連携（Python 側）【完了】

- [x] Supabase Python クライアント設定
- [x] プロジェクト存在チェック

### 📄 2. PDF 生成機能【完了】

- [x] `POST /export-pdf/{schedule_id}` エンドポイント
- [x] 工程表データから PDF 生成
- [x] システム固定フォーマット作成
- [x] PDF 出力処理

### ✅ 3. PDF 解析機能（インポート）【完了】

- [x] `POST /upload-pdf` エンドポイント
- [x] PDF ファイル読み込み機能
- [x] PyMuPDF 表構造検出（`find_tables()`）
- [x] 表データ抽出機能
- [x] データ構造化処理
- [x] 工程表データのバリデーション
- [x] 日付形式の統一処理
- [x] 必須項目チェック
- [x] ファイルアップロード処理
- [x] 工程表バージョン管理
- [x] データベース保存処理
- [x] トランザクション管理

### 🔧 4. API レスポンス統一【予定】

- [ ] レスポンス形式統一
- [ ] エラーハンドリング標準化

---

## ⏳ Phase 4: Web-PDF 連携実装【未着手】

### PDF アップロード UI（モーダル方式）

- [ ] プロジェクト選択・PDFアップロードモーダル作成
- [ ] ファイル選択コンポーネント  
- [ ] ドラッグ&ドロップ機能
- [ ] プログレス表示
- [ ] ファイル形式チェック（PDFのみ）
- [ ] ファイルサイズ制限（10MB）

### FastAPI 連携

- [ ] Server Action 実装（PDF アップロード）
- [ ] FormData 作成・送信
- [ ] FastAPI 通信処理
- [ ] レスポンス処理
- [ ] アップロード成功表示
- [ ] エラーメッセージ表示
- [ ] 工程表データプレビュー
- [ ] 詳細ページへのリダイレクト

### ✅ PDF 出力連携【完了】

- [x] PDF 出力ボタン実装
- [x] FastAPI 呼び出し処理
- [x] PDF ダウンロード機能
- [x] 出力ステータス表示

---

## ⏳ Phase 5: テスト・最終調整【未着手】

### 結合テスト

- [ ] PDF アップロード → DB 保存 → Web 表示フロー
- [ ] データ更新 → PDF 出力フロー
- [ ] Next.js ↔ FastAPI 連携テスト
- [ ] エンドツーエンドテスト
- [ ] エラーケーステスト

### 動作検証

- [ ] サンプル PDF での動作確認
- [ ] データ保存確認
- [ ] UI/UX 確認
- [ ] パフォーマンステスト

### 最終確認（ticket-004 の完了条件）

- [ ] 全画面が実装指示書通りに表示される
- [ ] レスポンシブ対応が完了している
- [ ] モックデータで正常に動作する
- [ ] PDF ファイルのアップロード・解析が動作する
- [ ] 工程表データから PDF 生成ができる
- [ ] API ドキュメントが自動生成される
- [ ] 全ての CRUD 操作が動作する
- [ ] PDF 処理から DB 保存まで連携動作する
- [ ] Web 画面でリアルタイムデータが表示される

### ドキュメント整備

- [ ] API 仕様書更新
- [ ] フォーマット仕様書作成
- [ ] 使用方法ドキュメント
- [ ] トラブルシューティング

---

## 🔮 将来フェーズ（初回リリース後）

### 認証機能

- [ ] Supabase Auth 実装
- [ ] users テーブル作成
- [ ] ログイン画面実装
- [ ] セッション管理
- [ ] アクセス制御

### 追加機能

- [ ] 新規工程表作成機能（ゼロから作成）
- [ ] CSV エクスポート機能
- [ ] 複数 PDF ファイルの一括アップロード
- [ ] PDF プレビュー機能
- [ ] アップロード履歴管理
- [ ] 取引先別アクセス制御
- [ ] 通知機能

### PDF 処理改善

- [ ] 工程名列の自動改行対応
- [ ] 担当者列の自動改行対応
- [ ] 備考列の自動改行対応
- [ ] PyMuPDF でのセル内マルチライン表示最適化
- [ ] テキスト折返し・レイアウト自動調整機能

---

## 📝 技術的メモ

### 現在の状況

- **完了**: Web UI 全実装、DB 構築、Web-DB 連携、FastAPI 基盤構築
- **着手中**: Supabase 連携（Python 側）
- **次の予定**: PDF 生成機能 → PDF 解析機能 → Web-PDF 連携

### 技術的課題

- PyMuPDF の表検出精度の検証が必要
- FastAPI のデプロイ方法（Railway/Render）
- CORS 設定の調整
- PDF フォーマットの柔軟性 vs 実装コストのバランス

### デプロイ計画

- **Next.js**: Vercel（設定済み）
- **FastAPI**: Railway or Render（未設定）
- **Supabase**: 設定済み

---

**最終更新**: 2025/08/10
**更新者**: Claude
