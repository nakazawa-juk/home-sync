# HomeSync - 統合TODO

## 開発フロー

```
Web実装(完了) → DB構築・繋ぎ込み(完了) → PDF機能実装(着手中) → Web-PDF連携 → 調整・改善 → リリース
```

---

## 🎯 現在の進捗状況

- **開始日**: 2025/08/10
- **現在のフェーズ**: PDF機能実装（Phase 3）
- **完了タスク数**: Phase 1・2完了（Web UI + FastAPI基盤）
- **現在着手中**: Supabase連携（Python側）→PDF生成→PDF解析の順で実装

---

## ✅ Phase 1: Web UI実装【完了】

### 完了済みタスク

- [x] プロジェクト一覧画面
  - [x] サイドバーナビゲーション
  - [x] プロジェクト一覧テーブル
  - [x] フィルター機能（UIのみ）
  - [x] 新規作成・PDFインポートボタン
  - [x] 空の状態表示
- [x] プロジェクト詳細画面
  - [x] 概要タブ実装
  - [x] 工程表タブ実装
  - [x] ガントチャート表示
  - [x] タブ切り替え機能
- [x] レスポンシブ対応
  - [x] デスクトップ表示
  - [x] タブレット対応
  - [x] モバイル対応
- [x] 状態管理
  - [x] ローディング状態
  - [x] エラー状態
  - [x] 空データ状態

---

## ✅ DB構築・Web連携【完了】

### 完了済みタスク

- [x] Supabaseセットアップ
  - [x] プロジェクト作成
  - [x] データベーススキーマ作成
  - [x] テーブル作成（projects, project_schedules, schedule_items）
- [x] Next.js側実装
  - [x] Supabase クライアント設定
  - [x] Server Actions実装
  - [x] データ取得・更新ロジック
  - [x] DBデータと画面の繋ぎ込み（全画面完了）

---

## 🔄 Phase 2: PDF処理サービス基盤【着手中】

### サンプルPDF作成【完了】

- [x] 標準フォーマット設計
- [x] サンプルPDF生成スクリプト作成（/docs/samples/）
- [x] sample_schedule.pdf生成完了
- [x] DBスキーマとの整合性確認

### FastAPI基盤構築【完了】

- [x] `backend/` ディレクトリ作成
- [x] FastAPIプロジェクト初期化
- [x] `requirements.txt` 作成（FastAPI, PyMuPDF, Supabase等）
- [x] `main.py` 基本アプリケーション作成
- [x] `config.py` 設定管理実装
- [x] `database.py` Supabase接続設定
- [x] `pyproject.toml` プロジェクト設定作成
- [x] `.env.example` 環境変数テンプレート作成
- [x] `/health` エンドポイント実装
- [x] CORS設定（Next.js連携用）
- [x] エラーハンドリング基盤
- [x] ログ設定
- [x] Dockerfile作成

---

## ⏳ Phase 3: PDF処理機能実装【着手】

### ✅ 1. Supabase連携（Python側）【完了】

- [x] Supabase Python クライアント設定
- [x] プロジェクト存在チェック

### 📄 2. PDF生成機能【完了】

- [x] `POST /export-pdf/{schedule_id}` エンドポイント
- [x] 工程表データからPDF生成
- [x] システム固定フォーマット作成
- [x] PDF出力処理

### 📤 3. PDF解析機能（インポート）【予定】

- [ ] `POST /upload-pdf` エンドポイント
- [ ] PDFファイル読み込み機能
- [ ] PyMuPDF表構造検出（`find_tables()`）
- [ ] 表データ抽出機能
- [ ] データ構造化処理
- [ ] 工程表データのバリデーション
- [ ] 日付形式の統一処理
- [ ] 必須項目チェック
- [ ] ファイルアップロード処理
- [ ] 工程表バージョン管理
- [ ] データベース保存処理
- [ ] トランザクション管理

### 🔧 4. APIレスポンス統一【予定】

- [ ] レスポンス形式統一
- [ ] エラーハンドリング標準化

---

## ⏳ Phase 4: Web-PDF連携実装【未着手】

### PDFアップロードUI

- [ ] アップロードページ作成（`/projects/[id]/upload/page.tsx`）
- [ ] ファイル選択コンポーネント
- [ ] ドラッグ&ドロップ機能
- [ ] プログレス表示
- [ ] ファイル形式チェック（PDFのみ）
- [ ] ファイルサイズ制限（10MB）

### FastAPI連携

- [ ] Server Action実装（PDFアップロード）
- [ ] FormData作成・送信
- [ ] FastAPI通信処理
- [ ] レスポンス処理
- [ ] アップロード成功表示
- [ ] エラーメッセージ表示
- [ ] 工程表データプレビュー
- [ ] 詳細ページへのリダイレクト

### ✅ PDF出力連携【完了】

- [x] PDF出力ボタン実装
- [x] FastAPI呼び出し処理
- [x] PDFダウンロード機能
- [x] 出力ステータス表示

---

## ⏳ Phase 5: テスト・最終調整【未着手】

### 結合テスト

- [ ] PDF アップロード → DB 保存 → Web 表示フロー
- [ ] データ更新 → PDF 出力フロー
- [ ] Next.js ↔ FastAPI連携テスト
- [ ] エンドツーエンドテスト
- [ ] エラーケーステスト

### 動作検証

- [ ] サンプルPDFでの動作確認
- [ ] データ保存確認
- [ ] UI/UX確認
- [ ] パフォーマンステスト

### 最終確認（ticket-004の完了条件）

- [ ] 全画面が実装指示書通りに表示される
- [ ] レスポンシブ対応が完了している
- [ ] モックデータで正常に動作する
- [ ] PDFファイルのアップロード・解析が動作する
- [ ] 工程表データからPDF生成ができる
- [ ] API ドキュメントが自動生成される
- [ ] 全てのCRUD操作が動作する
- [ ] PDF処理からDB保存まで連携動作する
- [ ] Web画面でリアルタイムデータが表示される

### ドキュメント整備

- [ ] API仕様書更新
- [ ] フォーマット仕様書作成
- [ ] 使用方法ドキュメント
- [ ] トラブルシューティング

---

## 🔮 将来フェーズ（初回リリース後）

### 認証機能

- [ ] Supabase Auth実装
- [ ] usersテーブル作成
- [ ] ログイン画面実装
- [ ] セッション管理
- [ ] アクセス制御

### 追加機能

- [ ] 新規工程表作成機能（ゼロから作成）
- [ ] CSVエクスポート機能
- [ ] 複数PDFファイルの一括アップロード
- [ ] PDFプレビュー機能
- [ ] アップロード履歴管理
- [ ] 取引先別アクセス制御
- [ ] 通知機能

### PDF処理改善

- [ ] 工程名列の自動改行対応
- [ ] 担当者列の自動改行対応
- [ ] 備考列の自動改行対応
- [ ] PyMuPDFでのセル内マルチライン表示最適化
- [ ] テキスト折返し・レイアウト自動調整機能

---

## 📝 技術的メモ

### 現在の状況

- **完了**: Web UI全実装、DB構築、Web-DB連携、FastAPI基盤構築
- **着手中**: Supabase連携（Python側）
- **次の予定**: PDF生成機能 → PDF解析機能 → Web-PDF連携

### 技術的課題

- PyMuPDFの表検出精度の検証が必要
- FastAPIのデプロイ方法（Railway/Render）
- CORS設定の調整
- PDFフォーマットの柔軟性vs実装コストのバランス

### デプロイ計画

- **Next.js**: Vercel（設定済み）
- **FastAPI**: Railway or Render（未設定）
- **Supabase**: 設定済み

---

**最終更新**: 2025/08/10
**更新者**: Claude
